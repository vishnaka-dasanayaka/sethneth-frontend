<!-- Modal Backdrop -->
<div
  *ngIf="showModal"
  class="fixed inset-0 bg-black/50 z-100 flex items-center justify-center"
>
  <!-- Modal Container -->
  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl mx-auto z-50">
    <!-- Modal Header -->
    <div class="flex justify-between items-center px-6 py-4 border-b">
      <h4 class="text-xl font-semibold text-gray-800">Add Prescription</h4>
      <button
        type="button"
        class="text-gray-500 hover:text-red-600 text-xl"
        (click)="closeModal()"
      >
        &times;
      </button>
    </div>

    <!-- Modal Body -->
    <div class="px-6 py-4 overflow-y-auto h-[90vh]">
      <form
        [formGroup]="valForm"
        (ngSubmit)="submitForm(valForm.value)"
        class="space-y-4"
      >
        <!-- Form Content -->
        <div class="p-6 space-y-8">
          <div class="grid grid-cols-4">
            <h1 class="text-lg font-semibold text-[#ff820d]">VA</h1>
            <div class="flex flex-col items-center justify-end">
              <div class="flex mb-1 items-center justify-start">
                <h1 class="text-lg font-semibold mr-2">R</h1>
                <input
                  type="text"
                  formControlName="var1"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
                <span class="px-1">/</span>
                <input
                  formControlName="var2"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
              </div>
              <div class="flex items-center justify-end">
                <h1 class="text-lg font-semibold mr-[10px]">L</h1>
                <input
                  type="text"
                  formControlName="val1"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
                <span class="px-1">/</span>
                <input
                  formControlName="val2"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
              </div>
            </div>

            <div class="flex flex-col items-center justify-end">
              <div class="flex mb-1 items-center justify-start">
                <h1 class="text-lg font-semibold mr-2">PH</h1>
                <input
                  formControlName="var_ph1"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
                <span class="px-1">/</span>
                <input
                  formControlName="var_ph2"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
              </div>
              <div class="flex items-center justify-end">
                <h1 class="text-lg font-semibold mr-2">PH</h1>
                <input
                  formControlName="val_ph1"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
                <span class="px-1">/</span>
                <input
                  formControlName="val_ph2"
                  type="text"
                  class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                />
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <h2 class="text-lg font-semibold text-[#ff820d]">Reti Test</h2>

            <div class="flex justify-start items-center">
              <div class="flex flex-col items-center justify-end">
                <div class="flex mb-1 items-center justify-start">
                  <h1 class="text-lg font-semibold mr-10">R</h1>
                  <input
                    type="text"
                    formControlName="reti_r1"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                  <span class="px-1">-</span>
                  <input
                    type="text"
                    formControlName="reti_r2"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                  <span class="px-1">-</span>
                  <input
                    type="text"
                    formControlName="reti_r3"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                </div>
                <div class="flex mb-1 items-center justify-start">
                  <h1 class="text-lg font-semibold mr-[42px]">L</h1>
                  <input
                    type="text"
                    formControlName="reti_l1"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                  <span class="px-1">-</span>
                  <input
                    type="text"
                    formControlName="reti_l2"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                  <span class="px-1">-</span>
                  <input
                    type="text"
                    formControlName="reti_l3"
                    class="w-10 border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="text-lg font-semibold text-[#ff820d]">HbRx</label>

              <p-datepicker
                class="w-full"
                [inputStyle]="{ width: '100%', height: '34px' }"
                formControlName="hbrx"
              />
            </div>
          </div>

          <!-- Main Table -->
          <div class="space-y-4">
            <h2 class="text-lg font-semibold text-[#ff820d]">
              Vision Test Results
            </h2>
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-orange-100">
                  <th class="border p-2"></th>
                  <th colspan="3" class="border p-2 text-center">R</th>
                  <th colspan="3" class="border p-2 text-center">L</th>
                  <th class="border p-2"></th>
                </tr>
                <tr class="bg-orange-50">
                  <th class="border p-2">VA</th>
                  <th class="border p-2">SPH</th>
                  <th class="border p-2">CYL</th>
                  <th class="border p-2">AXIS</th>
                  <th class="border p-2">SPH</th>
                  <th class="border p-2">CYL</th>
                  <th class="border p-2">AXIS</th>
                  <th class="border p-2">VA</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="border p-2">
                    <span class="flex justify-center items-center">
                      <input
                        type="text"
                        formControlName="r_va1"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                      <span class="px-1">/</span>
                      <input
                        type="text"
                        formControlName="r_va2"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                    </span>
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="r_sph"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="r_cyl"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="r_axis"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="l_sph"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="l_cyl"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="l_axis"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <span class="flex justify-center items-center">
                      <input
                        type="text"
                        formControlName="l_va1"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                      <span class="px-1">/</span>
                      <input
                        type="text"
                        formControlName="l_va2"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                    </span>
                  </td>
                </tr>
                <tr>
                  <td class="border p-2" colspan="4">
                    <input
                      type="text"
                      formControlName="r_sum"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2" colspan="4">
                    <input
                      type="text"
                      formControlName="l_sum"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Sub Test/Suggest Section -->
          <div class="space-y-4">
            <h2 class="text-lg font-semibold text-[#ff820d]">
              Sub test/ suggest
            </h2>
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-orange-100">
                  <th class="border p-2"></th>
                  <th colspan="3" class="border p-2 text-center">R</th>
                  <th colspan="3" class="border p-2 text-center">L</th>
                  <th class="border p-2"></th>
                </tr>
                <tr class="bg-orange-50">
                  <th class="border p-2">VA</th>
                  <th class="border p-2">SPH</th>
                  <th class="border p-2">CYL</th>
                  <th class="border p-2">AXIS</th>
                  <th class="border p-2">SPH</th>
                  <th class="border p-2">CYL</th>
                  <th class="border p-2">AXIS</th>
                  <th class="border p-2">VA</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="border p-2">
                    <span class="flex justify-center items-center">
                      <input
                        type="text"
                        formControlName="sub_r_va1"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                      <span class="px-1">/</span>
                      <input
                        type="text"
                        formControlName="sub_r_va2"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                    </span>
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_r_sph"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_r_cyl"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_r_axis"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_l_sph"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_l_cyl"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <input
                      type="text"
                      formControlName="sub_l_axis"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2">
                    <span class="flex justify-center items-center">
                      <input
                        type="text"
                        formControlName="sub_l_va1"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                      <span class="px-1">/</span>
                      <input
                        type="text"
                        formControlName="sub_l_va2"
                        class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                      />
                    </span>
                  </td>
                </tr>
                <tr>
                  <td class="border p-2" colspan="4">
                    <input
                      type="text"
                      formControlName="sub_r_sum"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                  <td class="border p-2" colspan="4">
                    <input
                      type="text"
                      formControlName="sub_l_sum"
                      class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Special Notes -->
          <div class="space-y-2">
            <label class="block font-medium text-[#ff820d]"
              >Special notes</label
            >
            <textarea
              formControlName="notes"
              class="w-full border rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1 h-20"
            ></textarea>
          </div>

          <!-- Footer -->
          <div class="grid grid-cols-2 gap-4 pt-4 border-t">
            <div class="space-y-2">
              <label class="block font-medium">R/V Date</label>

              <p-datepicker
                formControlName="rv_date"
                class="w-full"
                [inputStyle]="{ width: '100%', height: '34px' }"
              />
            </div>
            <div class="space-y-2 text-right">
              <label class="block font-medium">SIGNED BY</label>
              <input
                formControlName="signed_by"
                type="text"
                class="w-full border rounded text-center border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 px-2 py-1"
              />
            </div>
          </div>
        </div>

        <div class="flex justify-end space-x-2 pt-4">
          <button
            type="button"
            class="px-4 py-2 border rounded text-gray-700 border-gray-400 hover:bg-gray-100"
            (click)="closeModal()"
          >
            Close
          </button>
          <button
            type="submit"
            class="px-5 py-2 rounded text-white"
            [ngClass]="
              valForm.valid
                ? 'bg-orange-500 hover:bg-orange-600'
                : 'bg-orange-400 cursor-not-allowed'
            "
            [disabled]="valForm.invalid"
          >
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
